<h4 style="text-align:center; margin-top:20px;">Report Overdue Fix Request</h4>
    <br>
    
    <div class="container">
        <div style="border-radius:10px; border-style:solid; border-width:1px; padding-top:20px; padding-bottom:20px;" class="col-md-12">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="form-inline">
                                <p style="margin-bottom:0px;">Start :</p>
                                <input id="StartDate" type="date" style="width:300px; height:40px;">
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="form-inline">
                                <p style="margin-bottom:0px;">End :</p>
                                <input id="EndDate" type="date" style="width:300px; height:40px;">
                            </div>
                        </div>
                    </div>     
                    <br>
                <div class="form-inline col-md-4 offset-md-4">
                    <center>
                            <button type="button" onclick="GetReport();" class="btn btn-primary ">Get Report</button>
                            <button type="button" onclick="ClearReport();" class="btn btn-danger">Clear</button>
                    </center>
                </div>
            </div>
        </div>
    </div>   
   <br>

   <script type="text/javascript">

    var column_data = [
        
        'View',
        'Duedate',
        'Duedate_Unit',
        'PeriodTime',
        'FormStatus',
        'Issued_By_text',
        'Serial_No',
        'TypeHardware',
        'Function',
        'DocNo',
        'Issued_Date',
        'LocationSite',
        'SupplierName',
        'SupplierMail',
        'SupplierTel',
        'DataCondition'
       

    ];
    var column_title = [
        'View',
        'เวลาที่กำหนด',
        'หน่วย',
        'ระยะเวลาที่ใช้',
        'FormStatus',
        'ผู้สร้าง',
        'Serial_No',
        'ประเภทฮาร์ดแวร์',
        'Function',
        'DocNo',
        'วันที่สร้าง',
        'LocationSite',
        'SupplierName',
        'SupplierMail',
        'SupplierTel',
        'DataCondition'
    ]
  
    var column_query = [
        'View',
        'Duedate',
        'Duedate_Unit',
        'FormStatus',
        'Issued_By_text',
        'Serial_No',
        'TypeHardware',
        'Function',
        'DocNo',
        'Issued_Date',
        'LocationSite',
        'SupplierName',
        'SupplierMail',
        'SupplierTel',
        'DataCondition'

    ];

    function GetReport(){

        var loading = '<center><div class="loader" style="margin-top:15%; margin-bottom:15%;"></div></center>';
        $('#Result').empty();
        $('#Result').append(loading);
        var StartDate = $('#StartDate').val();
        var EndDate = $('#EndDate').val();
        if(StartDate && EndDate){
            StartDate = new Date(StartDate);
            EndDate = new Date(EndDate);

            StartDate = StartDate.toISOString();
            EndDate = EndDate.toISOString();


            var col = '';
            for(i=0;i<column_query.length;i++){
                if(i==column_query.length-1){
                    col+=column_query[i];
                }
                else{
                    col+=column_query[i]+',';
                }
            }


            var query = '?$select='+column_query+'&$top=5000&$filter=FormStatus ne \'Complete\' and Created ge datetime\''+StartDate+'\' and Created le datetime\''+EndDate+'\'&$orderby=Created asc';
            var data = GetItemByRestAPI('RequestFix',query);
            if(data){

                var TempTable =[];
                for(i=0;i<data.length;i++){
                    DataSet = data[i];
                    var today = new Date();
                    var period = GetIntervalDate(DataSet.Issued_Date,today);
                    var overdue ;
                    var str_period = '';
                    if(DataSet.Duedate == '24' && DataSet.Duedate_Unit == 'Hrs'){ // check 24 hrs = 1 day
                        overdue = 1;
                    }
                    else if(DataSet.Duedate_Unit == 'Day'){
                        overdue = DataSet.Duedate;
                    }

                    if(period > overdue){
                        str_period = '<p style="margin-bottom:0px; color:red;">'+period+'</p>';
                        
                    }else{
                        str_period = '<p style="margin-bottom:0px;">'+period+'</p>';
                    }


                    TempArr = {
                        
                        View: DataSet.View,
                        Duedate: DataSet.Duedate,
                        Duedate_Unit: DataSet.Duedate_Unit,
                        PeriodTime: str_period,
                        FormStatus: DataSet.FormStatus,
                        Issued_By_text: DataSet.Issued_By_text,
                        Serial_No: DataSet.Serial_No,
                        TypeHardware: DataSet.TypeHardware,
                        Function:DataSet.Function,
                        DocNo:DataSet.DocNo,
                        Issued_Date: DataSet.Issued_Date,
                        LocationSite: DataSet.LocationSite,
                        SupplierName: DataSet.SupplierName,
                        SupplierMail: DataSet.SupplierMail,
                        SupplierTel: DataSet.SupplierTel,
                        DataCondition: DataSet.DataCondition


                        
                    };

                 
                        TempTable.push(TempArr);
                   
                  
                    
                }
                data = TempTable;

                RenderReport(data,column_data);
            }
        
        }
        else{
            $('#Result').empty();
            alert('Please Input StartDate and EndDate..');
        }
        
    }
    function ClearReport(){
        $('#Result').empty();
        $('#myInput').val('');
    }
   function GetIntervalDate(from , to){

    var date1 = new Date(from);
    var date2 = new Date(to);
    var timeDiff = Math.abs(date2.getTime() - date1.getTime());
    var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 
    

    return diffDays;
   }
   </script>